
# 文章閱讀:Blockchain-Enabled Federated Learning: A Reference Architecture Design, Implementation, and Verification


- 原文: https://arxiv.org/abs/2306.10841
- 作者
- 時間: 2023/11
- 關鍵字: Blockchain, federated learning, blockchain-enabled federated learning (BCFL), reference architecture, Ethereum test network deployment, decentralized identifier (DID), client selection, client evaluation, smart contracts, data privacy and security.


# Introduction

區塊鏈與聯邦學習的整合是一個迅速發展的研究領域，旨在解決聯邦學習所面臨的挑戰:

1. 缺乏對故意破壞學習生態系統的客戶的懲罰措施、集中學習可能帶來的單點故障問題
2. 學習者無法聲明和驗證其本地生成模型的所有權
3. 聯邦學習中的系統異質性問題尤其重要，需考慮涉及多種設備的多樣特徵

然而，目前在現實環境中經過嚴格測試的實際應用明顯不足。值得注意的是，現有研究主要集中在這些技術整合的理論層面，卻未充分探討其實際部署所面臨的限制和挑戰。為了填補這一研究空白，本文開發了一種新穎的區塊鏈增強聯邦學習（BCFL）參考架構。該架構專門設計用於促進實用研究和現實世界的實施，從而為未來的BCFL應用提供可操作的藍圖。為此，作者引入了一個基於智能合約的激勵系統，並使用去中心化識別碼（DIDs）進行身份驗證。我們的主要貢獻包括：

- 設計一個BCFL參考架構並在實際以太坊開發環境中進行實現和驗證。
- 定義並進行智能合約功能、利益相關者角色（例如，工作創造者、評估者和培訓者）以及使用星際文件系統（IPFS）在聯邦學習參與者之間共享學習模型的全面分析。
- 提出一種擴展架構，以支持跨設備和跨孤島的聯邦學習場景。
- 通過與DID訪問系統的集成，開發聯邦學習參與者的身份訪問和管理方法。
- 通過比較以太坊測試網和BCFL的本地模擬網絡的部署成本，審查操作成本。

# BACKGROUND AND RELATED WORK
## BLOCKCHAIN

1. **區塊鏈技術定義**：
   - 區塊鏈是一種分散式帳本技術，實現安全、透明的交易。
   - 每個節點維護帳本副本，所有變更需經節點共識驗證。
2. **數據完整性和不可變性**：
   - 一旦交易記錄在區塊鏈上，無法更改或刪除，確保數據的完整性。
3. **去中心化特性**：
   - 消除中介或中央權威，所有交易對網絡成員透明且可訪問。
4. **應用場景**：
   - 區塊鏈被廣泛應用於金融交易、供應鏈管理、投票系統、身份管理和醫療保健等領域。
5. **技術優勢**：
   - 提供信任、安全和透明度，成為各行各業的理想解決方案。
6. **人工智能與區塊鏈的潛力**：
   - 兩者結合有潛力提升行業的安全性、透明度和效率，推動研究和應用的發展。

## BLOCKCHAIN-ENABLED FEDERATED LEARNING (BCFL)

1. **概念**：
   - BCFL（區塊鏈增強聯邦學習）結合了聯邦學習的原則和區塊鏈技術的安全特性，允許數據在各個設備上本地收集和處理，而非集中存儲。
2. **優勢**：
   - 提供安全和高效的數據及模型共享，克服傳統機器學習中的數據隱私和安全問題。
   - 去中心化的結構消除了單點故障的風險，增強了參與者之間的可信度和透明度。
3. **應用潛力**：
   - 在物聯網（IoT）和醫療應用等多個領域具有廣泛的潛在應用。
   - 組合傳統聯邦學習和區塊鏈技術可能改變現有的學習結構，保護個人信息。
4. **範例**：
   - **TrustFed**是一個跨設備場景框架，提供公平性和信任，實施了區塊鏈智能合約和統計異常檢測技術。
5. **研究和實踐**：
   - 對於數據保護的研究強調了BCFL的重要性，並探索了其在不同網絡環境中的應用。
   - BCFL在分散式醫療服務中顯示出增強數據可用性、安全性和透明性的潛力，與現有的分散式數據存儲系統、區塊鏈和混合計算集成。
6. **參考架構**：
   - BCFL的參考架構強調模塊化設計，明確利益相關者的角色，提供可擴展性和靈活性。
7. **自動獎勵機制**：
   - BCFL引入了透過智能合約實現的自動獎勵機制，有助於防止潛在的惡意參與者，如在訓練過程中貢獻假數據的人。
   - 激勵機制缺失
       - 傳統的聯邦學習系統缺乏足夠的激勵來鼓勵分享去中心化的訓練數據和計算資源。區塊鏈技術被建議用以建立基於信任和激勵的去中心化、可公開審核的聯邦學習生態系統。
   - 合理激勵的必要性
       - 研究指出，沒有合理的激勵措施，參與者可能會對參與學習過程有所顧慮。需有激勵策略來防止惡意參與者損害模型性能。
   - 獎勵機制的複雜性
       - BCFL的分散特性使得直接監控參與者行為變得困難。為了解決這個問題，有研究利用經濟學的競爭理論提供了一個數學化和系統性的獎勵機制解決方案。

## DECENTRALIZED IDENTIFIERS (DID)

1. 特色
    - **去中心化管理**：DID 是一種以去中心化方式管理和保護數字身份的方法，使用唯一識別碼來創建可驗證且防篡改的數字身份，獨立於任何中央權威。
    - **分散擁有權**：DID 的關鍵特徵是將數字身份的擁有權和控制權分散給多方，抵消單一組織或法律實體的控制。
    - **隱私保護**：與傳統身份管理系統不同，DID 允許個人管理其數據並選擇分享對象，從而減少數據洩露的風險。
    - **加密存儲**：個人信息以分散和加密的格式存儲，提供更高的隱私和安全性。
2. **需求增長**：隨著數字環境的演變，對安全的去中心化身份管理解決方案的需求持續上升，DID 作為一種有前景的解決方案逐漸受到重視。
3. **可驗證憑證整合**：DID 與可驗證憑證（VC）的結合能提高隱私和安全性，並防止集中數據庫中的數據洩露。
4. **安全威脅緩解**：結合 VC 的 DID 能有效減輕 Sybil 攻擊等安全威脅，提供分散環境的身份驗證方案。
5. **與 BCFL 協同**：DID 的特性與 BCFL 的目標相一致，強調在分散環境中的學習和個人數據擁有權。

# BCFL REFERENCE ARCHITECTURE
![image](https://hackmd.io/_uploads/B1kGWGQ-yl.png)
## 六階段 BCFL 工作流程概述
BCFL 工作流程被分為兩個不同的階段。
1. 第一階段
    - 工作創建
    - 訓練者招募
2. 第二階段: 四個階段會重複進行預定數量的全局輪次，以確保全面的訓練和評估。
    - 訓練
    - 評估
    - 客戶選擇聚合
    - 代幣分配


![image](https://hackmd.io/_uploads/rJL_ff7-1x.png)

上圖說明更詳細的流程。交叉參考了關鍵實體及其各自的角色。橫向上，它將基本實體分為四種類型：BCFL 系統、利益相關者、IPFS 和區塊鏈。縱向上，它識別了參與者的類型：工作創建者、訓練者、評估者和聚合者。這種複雜的描繪不僅強調了不同實體類型之間的互動，還突顯了所提議的 BCFL 生態系統中角色的層次複雜性。

以下是將上述六個步驟整理成流程與說明的版本：

### 階段 1：工作創建
- **客戶發起任務**：客戶啟動 BCFL 任務，請求創建者根據其規範生成報價。
- **生成報價**：報價包括所需的深度學習模型類型、學習超參數的配置、所需的訓練者數量、全球回合數和創世模型等詳細信息。
- **部署模型**：工作創建者將創世模型部署並註冊任務。
- **上傳模型參數**：將模型參數上傳至 IPFS，並在區塊鏈上記錄返回的內容標識符（CID）。
- **智能合約互動**：通過加密錢包與智能合約互動，以便記錄區塊鏈上的詳細信息。

### 階段 2：訓練者招募
- **訓練者審核任務**：訓練者可以通過專用的網頁應用程序查看訓練任務並評估潛在收益（代幣）。
- **請求參加**：根據工作創建者的訓練配置，訓練者評估自己是否適合參加，如果合適，則通過應用程序請求參加。
- **管理申請**：BCFL 系統管理申請者列表並持續監控學習過程的結果。
- **過濾惡意訓練者**：系統通過評分行為過濾掉惡意訓練者，並創建經批准的訓練者白名單。
- **身份驗證**：訓練者使用 VC JSON 網頁令牌 (JWT) 或發出新的 DID 和 VC 進行身份驗證。

### 階段 3：訓練
- **開始訓練階段**：當訓練者招募階段完成後，智能合約將訓練狀態更新為訓練階段，並信號訓練開始。
- **下載創世模型**：訓練者通過調用智能合約中的功能來獲取創世模型的 CID，然後從 IPFS 獲取模型參數。
- **使用數據集進行訓練**：訓練者使用自己的數據集開始訓練。
- **註冊模型更新**：訓練者在 IPFS 和智能合約上註冊本地模型更新，並記錄更新的詳細信息，如訓練者身份和全球回合信息。

### 階段 4：評估
- **檢查智能合約**：評估者在全球回合訓練完成後檢查智能合約狀態，以決定是否開始評估階段。
- **下載本地模型參數**：評估者下載訓練者提交的本地模型參數。
- **進行評估**：使用預先準備的數據對模型進行評估。
- **頒發獎勵點數**：根據算法頒發獎勵點數，並將訓練者的得分、錢包地址和 CID 註冊到智能合約中。
- **記錄評估結果**：評估者在合約中記錄每位訓練者的模型特定分數。

### 階段 5：客戶選擇與聚合
- **客戶選擇**：這是可選的過程，可以根據智能合約中記錄的分數選擇下一輪的參與者。
- **檢索信息**：聚合器從智能合約中檢索訓練者、模型 CID 和貢獻點的列表。
- **模型聚合**：使用算法（如 FedAvg）將訓練者的本地模型合成為統一的全局模型。
- **記錄全局模型**：將全局模型記錄在 IPFS 和智能合約中，並在回合結束時評估客戶，記錄有資格參加下一輪的訓練者名單。

### 階段 6：代幣分配
- **分配代幣**：工作創建者利用預先部署的代幣合約向訓練者分配代幣，分配金額基於分數列表。
- **作為股份**：這些代幣旨在作為最終全局模型的股份。

## 智能合約

智能合約負責整個工作流程的監控，並處理過程中的關鍵信息。表 1 列出了在 BCFL 跨設備場景中合約所需的功能。以下是每個功能的詳細說明。

1) **回合控制**  
在 BCFL 中，通常沒有單獨的伺服器來管理學習過程。因此，智能合約需要處理回合的註冊和信息管理以及其持續時間。回合控制模塊包含這些功能，使利益相關者能夠持續監控當前回合和學習過程中的剩餘時間。一旦該回合的評估和聚合完成，該回合就被視為結束，過程將進入下一回合。
2) **客戶選擇**  
在客戶選擇中，根據評估結果管理每回合的訓練者至關重要。在聚合器進行特定回合的客戶選擇後，系統需要註冊合格訓練者的錢包地址。此功能應設置為便於訓練者進行驗證。在回合開始時，訓練者可以檢查自己的狀態以確認是否為有效參與者，並根據收到的狀態值決定是否繼續參加 BCFL 過程。
3) **評估**  
評估者評估訓練者提交的本地模型的性能，並將評估結果記錄在智能合約中。智能合約應能存儲本地模型的 CID、相應的得分和模型的訓練者信息。為了確保訪問控制，評估者對評估分數的訪問應受到如 solidity 修飾符等措施的限制。一旦特定回合的所有本地更新評估完成，評估完成狀態值應被更改，以允許其他訓練者進入下一訓練階段。雖然可以更改評估者，但這種更改僅限於不可避免的情況。
4) **全局模型保存**  
客戶選擇過程完成後，聚合器應能通過合約上傳聚合全局模型的 CID。
5) **訓練**  
在訓練過程中，訓練者下載全局模型，使用自己的數據進行訓練，然後將訓練好的模型上傳至 IPFS。因此，智能合約應包括存儲和檢索全局模型 CID 及相應回合的本地模型更新 CID 的功能。
6) **訓練啟動**  
工作創建者的角色包括在訓練過程開始時定義用作創世模型的模型，並將通過 IPFS 上傳的模型初始版本的 CID 記錄在合約中。這確保所有參與者都可以訪問該模型進行訓練。
7) **代幣分配**  
訓練者希望因其貢獻而獲得獎勵。代幣分配功能通過鏈接 ERC-20 和其他代幣介面合約來促進此過程，允許發行可以在實際網絡上交易的代幣。這些代幣具有價值，如作為最終全局模型的股份。
8) **FL 進度管理**  
除了上述功能外，以下功能對有效管理聯邦學習訓練的進度和狀態至關重要：
    - 在所有訓練者被招募後，智能合約接收到一個通知，標誌著聯邦學習訓練準備開始。
    - 進行狀態檢查以驗證特定訓練者是否成功上傳了當前回合的本地模型 CID。此檢查確保訓練過程中沒有異常，並且每位訓練者的貢獻都得到了記錄。
    - 為了評估相應回合的本地模型的貢獻，需要一個已完成訓練的模型 CID 列表。該列表有助於評估訓練模型的影響以及進一步的分析和聚合。













# 結論
以下是對文本的重點整理：

1. **BCFL 概述**：
   - BCFL（區塊鏈增強聯邦學習）結合了聯邦學習和區塊鏈技術的優勢，提供了一個去中心化的解決方案。
   - 研究介紹了一個新的參考架構，並在以太坊開發環境中進行了實現和驗證。
2. **架構驗證**：
   - 對比了在以太坊 Sepolia 測試網與 Ganache 模擬的本地網絡上部署智能合約的成本，發現生產環境和開發環境之間存在顯著差異。
   - 進一步的工作需要進行更深入的測試和驗證，專注於操作成本和交易處理速度。
3. **FL 過程驗證**：
   - 展示了在以太坊模擬網絡上運行的全球和本地模型的收斂趨勢。
   - 成功集成 DIDs 作為身份驗證方法，提高了全球模型評估中的表現，證實了其潛在價值。
4. **未來研究方向**：
   - 主要集中於評估系統性能，包括模型準確性和貢獻評估。
   - 強調公平和高效的貢獻評估對模型準確性和激勵機制的重要性。
5. **技術整合和擴展**：
   - 強調持續集成前沿技術和擴展客戶選擇方法的重要性。
   - 計劃在實際的以太坊主網絡或等效測試網絡上進行操作驗證和性能評估。
6. **未來工作重點**：
   - 分析 BCFL 系統的通信成本，特別是 IPFS 和區塊鏈的互動，旨在提高架構的效率和適用性。 


